<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Validation · ZIO Prelude</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="In our normal ZIO programs, we simply `flatMap` our effects using a `for-comprehension`. If one of the effects returns an `Error`, the whole calculation stops at that point (unless we handle the Error)."/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Validation · ZIO Prelude"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zio.github.io/zio-prelude/"/><meta property="og:description" content="In our normal ZIO programs, we simply `flatMap` our effects using a `for-comprehension`. If one of the effects returns an `Error`, the whole calculation stops at that point (unless we handle the Error)."/><meta property="og:image" content="https://zio.github.io/zio-prelude/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://zio.github.io/zio-prelude/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/zio-prelude/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"cornerOffset":100}
          )
        });
        </script><script src="/zio-prelude/js/scrollSpy.js"></script><link rel="stylesheet" href="/zio-prelude/css/main.css"/><script src="/zio-prelude/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/zio-prelude/"><img class="logo" src="/zio-prelude/img/navbar_brand2x.png" alt="ZIO Prelude"/><h2 class="headerTitleWithLogo">ZIO Prelude</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/zio-prelude/docs/overview/overview_index" target="_self">Overview</a></li><li class=""><a href="/zio-prelude/docs/usecases/usecases_index" target="_self">Use Cases</a></li><li class=""><a href="api/zio/prelude/index.html" target="_self">API</a></li><li class=""><a href="/zio-prelude/docs/about/about_index" target="_self">About</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Overview</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/overview/overview_index">Summary</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/overview/overview_diagrams">Type Class diagrams</a></li><li class="navListItem"><a class="navItem" href="/zio-prelude/docs/overview/overview_phantomtypes">Phantom Types</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/zio-prelude/docs/overview/overview_validation">Validation</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Validation</h1></header><article><div><span><p>In our normal ZIO programs, we simply <code>flatMap</code> our effects using a <code>for-comprehension</code>. If one of the effects returns an <code>Error</code>, the whole calculation stops at that point (unless we handle the Error).</p>
<p>But there are usecases where we don't want to stop our application, but rather collect all the errors. One example for a usecase like this is &quot;form validation&quot;, another one might be validating input from other systems.</p>
<h1><a class="anchor" aria-hidden="true" id="example-of-form-validation"></a><a href="#example-of-form-validation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example of form validation</h1>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Email</span>(<span class="hljs-params">address: <span class="hljs-type">String</span></span>)</span>
<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Email</span> </span>{
    <span class="hljs-keyword">val</span> regexp = <span class="hljs-string">"^(.+)@(.+)$"</span>.r
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fromString</span></span>(m: <span class="hljs-type">String</span>): <span class="hljs-type">Option</span>[<span class="hljs-type">Email</span>] = m <span class="hljs-keyword">match</span> {
        <span class="hljs-keyword">case</span> regexp(e) =&gt; <span class="hljs-type">Some</span>(e)
        <span class="hljs-keyword">case</span> _ =&gt; <span class="hljs-type">None</span>
    }
}

<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span>(<span class="hljs-params">name: <span class="hljs-type">String</span>, age: <span class="hljs-type">Int</span>, email: <span class="hljs-type">Email</span></span>)</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ValidationError</span>(<span class="hljs-params">msg: <span class="hljs-type">String</span></span>)</span>

<span class="hljs-keyword">import</span> zio.prelude._

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validateName</span></span>(u: <span class="hljs-type">User</span>) = <span class="hljs-type">Validation</span>.fromEither(
    <span class="hljs-type">Either</span>.cond(u.name.length &lt; <span class="hljs-number">3</span>, u.name, <span class="hljs-type">ValidationError</span>(<span class="hljs-string">"name too short"</span>))
).orElse(<span class="hljs-type">Validation</span>.fromEither(
    <span class="hljs-type">Either</span>.cond(u.name.length &lt; <span class="hljs-number">30</span>, u.name, <span class="hljs-type">ValidationError</span>(<span class="hljs-string">"name too long"</span>))
)).map(_ =&gt; u.name) <span class="hljs-comment">// orElse would normally generate a Tuple(u.name, u.name)</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validateAge</span></span>(u: <span class="hljs-type">User</span>) = <span class="hljs-type">Validation</span>.fromEither(
    <span class="hljs-type">Either</span>.cond(u.age &gt; <span class="hljs-number">13</span>, u.age, <span class="hljs-type">ValidationError</span>(<span class="hljs-string">"too young"</span>))
)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validateEmail</span></span>(u: <span class="hljs-type">User</span>): <span class="hljs-type">Validation</span>[<span class="hljs-type">ValidationError</span>, <span class="hljs-type">Email</span>] = <span class="hljs-type">Validation</span>
    .fromOption(<span class="hljs-type">Email</span>.fromString(u.email)) <span class="hljs-comment">// this would return a Validation[Unit, Email]</span>
    .mapError(_ =&gt; <span class="hljs-type">ValidationError</span>(<span class="hljs-string">"email is not valid"</span>)) <span class="hljs-comment">// but we want a proper error type</span>

<span class="hljs-comment">// lets collect all the errors</span>
<span class="hljs-keyword">val</span> validations: <span class="hljs-type">Validation</span>[<span class="hljs-type">ValidationError</span>, <span class="hljs-type">User</span>] = <span class="hljs-type">Validation</span>.validate(
    validateName(user),
    validateAge(user),
    validateEmail(user)
)((name, age, email) =&gt; <span class="hljs-type">User</span>(name, age, email))

<span class="hljs-keyword">val</span> myEffect: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Any</span>, <span class="hljs-type">Chunk</span>[<span class="hljs-type">ValidationError</span>], <span class="hljs-type">User</span>] = <span class="hljs-keyword">for</span> {
    _ &lt;- <span class="hljs-type">ZIO</span>.unit
    validated = validations.runLog
    (logs, errorsOrValue) = validated <span class="hljs-comment">// you can ignore the logs for now</span>
    user &lt;- <span class="hljs-type">ZIO</span>.fromEither(errorsOrValue)
} <span class="hljs-keyword">yield</span> user

</code></pre>
<p>The code above should be straight-forward, but you might be wondering what is going on with the <code>logs</code> returned by <code>runLog</code> ?</p>
<p>While other validation libraries only allow you to collect errors occured during validation, ZIO Prelude gives you another channel to
collect information that e.g. might be helpful to debug your program.</p>
<p>We can leverage this channel by using the <code>ZValidation</code> type, e.g. like this:</p>
<pre><code class="hljs css language-scala">
<span class="hljs-keyword">import</span> zio.prelude._

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validateEmailAdvanced</span></span>(u: <span class="hljs-type">User</span>): <span class="hljs-type">ZValidation</span>[<span class="hljs-type">String</span>, <span class="hljs-type">ValidationError</span>, <span class="hljs-type">Email</span>] =  validateEmail(u).flatMap(_ =&gt; 
    <span class="hljs-keyword">if</span>(u.email.endsWith(<span class="hljs-string">"hotmail.com"</span>)) { 
        <span class="hljs-type">ZValidation</span>.fail(<span class="hljs-type">ValidationError</span>(<span class="hljs-string">"email is not valid"</span>)).log(<span class="hljs-string">"email is a blocked domain"</span>)
    } <span class="hljs-keyword">else</span> { 
        <span class="hljs-type">ZValidation</span>.succeed(u.email)
    }
)

<span class="hljs-keyword">val</span> validations2: <span class="hljs-type">ZValidation</span>[<span class="hljs-type">String</span>, <span class="hljs-type">ValidationError</span>, <span class="hljs-type">User</span>] = <span class="hljs-type">Validation</span>.validate(
    validateName(user),
    validateAge(user),
    validateEmailAdvanced(user)
)((name, age, email) =&gt; <span class="hljs-type">User</span>(name, age, email))

<span class="hljs-keyword">val</span> myEffect2: <span class="hljs-type">ZIO</span>[<span class="hljs-type">ZEnv</span>, <span class="hljs-type">Chunk</span>[<span class="hljs-type">ValidationError</span>], <span class="hljs-type">User</span>] = <span class="hljs-keyword">for</span> {
    _ &lt;- <span class="hljs-type">ZIO</span>.unit
    validated = validations2.runLog
    (logs, errorsOrValue) = validated
    _ &lt;- <span class="hljs-type">ZIO</span>.foreach_(logs){msg =&gt; <span class="hljs-type">ZIO</span>.debug(msg)}
    user &lt;- <span class="hljs-type">ZIO</span>.fromEither(errorsOrValue)
} <span class="hljs-keyword">yield</span> user

</code></pre>
<p>But you're not limited to String as a Logging Type. You can use anything you want, e.g. to properly utilize log levels of <code>zio-logging</code>:</p>
<pre><code class="hljs css language-scala">
<span class="hljs-keyword">sealed</span> <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">ValidationLog</span></span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">message</span></span>: <span class="hljs-type">String</span>
}

<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ValidationLogInfo</span>(<span class="hljs-params">message: <span class="hljs-type">String</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">ValidationLog</span></span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">case</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ValidationLogError</span>(<span class="hljs-params">message: <span class="hljs-type">String</span></span>) <span class="hljs-keyword">extends</span> <span class="hljs-title">ValidationLog</span></span>


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">validateEmailAdvanced2</span></span>(u: <span class="hljs-type">User</span>): <span class="hljs-type">ZValidation</span>[<span class="hljs-type">ValidationLog</span>, <span class="hljs-type">ValidationError</span>, <span class="hljs-type">Email</span>] =  validateEmail(u).flatMap(_ =&gt; 
    <span class="hljs-keyword">if</span>(u.email.endsWith(<span class="hljs-string">"hotmail.com"</span>)) { 
        <span class="hljs-type">ZValidation</span>.fail(<span class="hljs-type">ValidationError</span>(<span class="hljs-string">"email is not valid"</span>)).log(<span class="hljs-type">ValidationLogDebug</span>(<span class="hljs-string">s"email <span class="hljs-subst">${u.email}</span> belongs to a blocked domain"</span>))
    } <span class="hljs-keyword">else</span> { 
        <span class="hljs-type">ZValidation</span>.succeed(u.email)
    }
)

<span class="hljs-keyword">val</span> validations3: <span class="hljs-type">ZValidation</span>[<span class="hljs-type">ValidationLog</span>, <span class="hljs-type">ValidationError</span>, <span class="hljs-type">User</span>] = <span class="hljs-type">Validation</span>.validate(
    validateName(user),
    validateAge(user),
    validateEmailAdvanced2(user)
)((name, age, email) =&gt; <span class="hljs-type">User</span>(name, age, email))


<span class="hljs-keyword">val</span> myEffect3: <span class="hljs-type">ZIO</span>[<span class="hljs-type">Has</span>[<span class="hljs-type">Logging</span>], <span class="hljs-type">Chunk</span>[<span class="hljs-type">ValidationError</span>], <span class="hljs-type">User</span>] = <span class="hljs-keyword">for</span> {
    _ &lt;- <span class="hljs-type">ZIO</span>.unit
    validated = validations3.runLog
    (logs, errorsOrValue) = validated
    _ &lt;- <span class="hljs-type">ZIO</span>.foreach_(logs){ 
        <span class="hljs-keyword">case</span> <span class="hljs-type">ValidationLogInfo</span>(m) =&gt; zio.logging.log.info(m)
        <span class="hljs-keyword">case</span> <span class="hljs-type">ValidationLogDebug</span>(m) =&gt; zio.logging.log.debug(m)
    }
    user &lt;- <span class="hljs-type">ZIO</span>.fromEither(errorsOrValue)
} <span class="hljs-keyword">yield</span> user

</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/zio-prelude/docs/overview/overview_phantomtypes"><span class="arrow-prev">← </span><span>Phantom Types</span></a></div></div></div><nav class="onPageNav"></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/zio-prelude/" class="nav-home"><img src="/zio-prelude/img/sidebar_brand2x.png" alt="ZIO Prelude"/></a><div><h5>GitHub</h5><a class="github-button" href="https://github.com/zio/zio-prelude" data-icon="octicon-star" data-count-href="/zio/zio-prelude/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div><div><h5>Chat with us on Discord</h5><a href="https://discord.gg/2ccFBr4"><img src="/zio-prelude//img/discord.png" width="120" alt="discord"/></a></div><div><h5>Additional resources</h5><a href="/zio-prelude/api/index.html">Scaladoc of zio-prelude</a></div></section><section class="copyright">Copyright © 2021 ZIO Maintainers</section></footer></div></body></html>